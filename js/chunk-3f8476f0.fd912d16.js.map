{"version":3,"sources":["webpack:///./src/assets/documents/document4/imgs/1677136009659.png","webpack:///./src/assets/documents/document4/imgs/1677137983405.jpg","webpack:///./src/assets/documents/document4/imgs/1677136496009.png","webpack:///./src/assets/documents/document4/Elasticsearch.md?a69c","webpack:///./src/assets/documents/document4/Elasticsearch.md","webpack:///./src/assets/documents/document4/imgs/1677134769658.jpg"],"names":["module","exports","render","_vm","this","_h","$createElement","_self","_c","_m","staticRenderFns","_v","attrs","pre","script","component"],"mappings":"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","file":"js/chunk-3f8476f0.fd912d16.js","sourcesContent":["module.exports = __webpack_public_path__ + \"img/1677136009659.32cf46c7.png\";","module.exports = __webpack_public_path__ + \"img/1677137983405.32bed19c.jpg\";","module.exports = __webpack_public_path__ + \"img/1677136496009.d5ebe235.png\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _vm._m(0)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',[_c('html',[_c('head'),_c('body',[_c('h1',[_vm._v(\"ELasticsearch\")]),_c('h1',[_vm._v(\"1、倒排索引\")]),_c('h2',[_vm._v(\"1.1、倒排索引创建的过程\")]),_c('ul',[_c('li',[_vm._v(\"搜索引擎中存储的是倒排索引，就是分好的词和词语文章的关联。\")]),_c('li',[_vm._v(\"实现把文章中词进行打散，以词为依据，然后关联上对应的文章。\")]),_c('li',[_vm._v(\"查询的时候，就是根据查词语找对对应的文章。\")])]),_c('p',[_c('img',{attrs:{\"src\":require(\"./imgs/1677137983405.jpg\"),\"alt\":\"\"}})]),_c('h2',[_vm._v(\"1.2、搜索过程\")]),_c('ul',[_c('li',[_vm._v(\"当用户搜索任意词条时，首先对用户输入的文本进行分词，获取需要搜索的词条。\")]),_c('li',[_vm._v(\"然后通过这个词条到倒排索引中去查询命中的词语。\")]),_c('li',[_vm._v(\"然后在根据这些命中的词语获取对应的文档id。\")]),_c('li',[_vm._v(\"然后在根据这些ID去获取文档数据。\")])]),_c('h1',[_vm._v(\"2、ES集群\")]),_c('p',[_vm._v(\"ES集群是由多个节点组成，通过cluster.name设置集群名字，并且用于区分其他集群，集群中每一个节点通过node.name指定节点名称。\")]),_c('p',[_vm._v(\"在ES集群中，存在的节点类型主要有四种。\")]),_c('ul',[_c('li',[_c('p',[_vm._v(\"master节点：\")]),_c('ul',[_c('li',[_vm._v(\"节点配置文件的node.master属性值为true，默认值也为true，表示该节点在集群中有可能被选举成主节点。\")]),_c('li',[_vm._v(\"master节点控制整个集群的操作，比如：创建，删除索引的操作，管理其他非master节点。\")])])]),_c('li',[_c('p',[_vm._v(\"data节点：\")]),_c('ul',[_c('li',[_vm._v(\"节点配置文件的node.data属性值为true，默认值也是true，表示该节点在集群中有可能成为数据节点。\")]),_c('li',[_vm._v(\"data节点主要的用于对文档数据的操作。比如：对文档的CURD操作。\")])])]),_c('li',[_c('p',[_vm._v(\"协调节点：\")]),_c('ul',[_c('li',[_vm._v(\"配置文件中node.data 和node.master均为false。\")]),_c('li',[_vm._v(\"该节点不能作为主节点和数据节点。\")]),_c('li',[_vm._v(\"可以用来的响应用户的请求，把请求转发到其他节点。\")])])])]),_c('h1',[_vm._v(\"3、分片和副本\")]),_c('p',[_vm._v(\"添加数据到ES中，需要创建一个索引，一个用来存储数据的地方。其实索引只是用来指向一个分片或多个分片的逻辑命名空间。\")]),_c('ul',[_c('li',[_vm._v(\"一个分片（shard）是一个最小级别的工作单元，分片只是保存索引中一小部分数据。\")]),_c('li',[_vm._v(\"一个分片就是一个lucene实例，并且它本身就一个完整的搜索引擎，应用程序不会直接和它通讯。\")]),_c('li',[_vm._v(\"分片可以分为主分片和复制分片。\")]),_c('li',[_vm._v(\"复制分片是主分片的一个副本，是防止主分片挂掉，造成数据丢失。\")]),_c('li',[_vm._v(\"当索引创建完成后，主分片的数量就固定了，但是复制分片的数量是可以调整的。\")])]),_c('p',[_vm._v(\"每一个索引上的数据会存在多个分片中，默认创建的索引是分片五个分片进行存储的，每一个分片都部署在分布式环境下多个节点上存。**索引的主分片定义好了，就不能在进行修改了。**为了数据的高可用，主分片可以对应多个复制分片，主分片和复制分片不能存放在同一台服务器上，避免服务宕机后，这个主分片的数据就丢失。\")]),_c('h1',[_vm._v(\"4、数据路由\")]),_c('p',[_vm._v(\"当客户端发起创建document的请求时，ES需要计算出该document存储在索引的哪一个分片上，这个过程就是数据路由。\")]),_c('p',[_vm._v(\"计算公式：\")]),_c('pre',{pre:true},[_c('code',{pre:true,attrs:{\"v-pre\":\"\"}},[_vm._v(\"路由算法：shard = hash(routing) % number_of_primary_shards\\n\")])]),_c('p',[_vm._v(\"如果在查询数据时number_of_primary_shards发生变化，就无法获取数据。\")]),_c('p',[_c('strong',[_vm._v(\"所以：主分区一旦确定了，就不能进行修改。\")])]),_c('ul',[_c('li',[_vm._v(\"routing：是一个任意的字符串，它默认是文档的id，但是也可以自定义。\")]),_c('li',[_vm._v(\"这个routing字符串通过hash函数生成一个数字，然后除以主分片数量的余数。这个余数就是0 - 主分片 - 1的范围。\")])]),_c('h1',[_vm._v(\"5、ES操作\")]),_c('h2',[_vm._v(\"5.1、插入文档\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./imgs/1677134769658.jpg\"),\"alt\":\"\"}})]),_c('p',[_vm._v(\"新建文档的流程：\")]),_c('ul',[_c('li',[_vm._v(\"client向node1发送新建请求，协调节点，通过hash算法可以计算可以计算出在哪一个分片上，然后路由到对应的节点 shard = hash(document_id) % number_of_primary)_shards。\")]),_c('li',[_vm._v(\"节点使用文档_id确定文档属于分片0，请求就会被转发到node3上，因为分片0在node3节点上。\")]),_c('li',[_vm._v(\"在node3上请求执行成功后，它就会将node3的分片0将数据复制到node1和node2上面，一旦所有的复制分片复制成功后，node3就向协调节点报告成功，协调节点向客户端报告成功。\")])]),_c('h2',[_vm._v(\"5.2、更新文档\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./imgs/1677136009659.png\"),\"alt\":\"\"}})]),_c('ul',[_c('li',[_vm._v(\"客户端想node1发送一个请求，node1作为协调节点，会根据文档id计算出该文档属于哪一个分片上，计算方法于上面数据路由计算方式一样。\")]),_c('li',[_vm._v(\"计算出该文档在分片0上，分片0在node3上，然后在将请求转发到node3上。\")]),_c('li',[_vm._v(\"node3上主分片检索文档，修改文档中source中数据。\")]),_c('li',[_vm._v(\"node3更新成功后，主分片就会将更新的数据分复制到node1和node2上副本分片上，当所有副本分片都返回成功后，node3向协调节点返回。此时协调节点会响应给client。\")])]),_c('h2',[_vm._v(\"5.3、删除文档\")]),_c('p',[_c('img',{attrs:{\"src\":require(\"./imgs/1677136496009.png\"),\"alt\":\"\"}})]),_c('p',[_vm._v(\"该过程可以分为一些四个阶段：\")]),_c('ul',[_c('li',[_vm._v(\"客户端向node1发送一个删除文档的请求。\")]),_c('li',[_vm._v(\"于上面相同，node1会计算除该文档处于哪一个分片上，但是操作是操作的主分片，计算得出需要操作分片在node3上。\")]),_c('li',[_vm._v(\"将请求转发到node3上，需要在主分片上操作。如果在node3上主分支删除成功后，会复制到所有副本分片上。\")]),_c('li',[_vm._v(\"当所有的副本分片成功后，才会返回到协调节点上，协调节点返回给client端。\")])]),_c('p',[_vm._v(\"ES是建立在lucene基础上的实时的分布式搜索引擎，lucene为了提高搜索的效率，所有lucene中的数据是不允许被修改的，这些文档存放在segment中，也就是说，一个segment写到存储系统中，就不能被修改的，lucene是如何删除一个文档呢？\")]),_c('ul',[_c('li',[_vm._v(\"当用户发送一个删除请时，会先搜索到该文档。\")]),_c('li',[_vm._v(\"然后通过一个标记，来标记该文档已经被删除了。\")]),_c('li',[_vm._v(\"ES在segment中搜索时，可以搜索到该文档，但是该文档已经被标记为删除了。\")]),_c('li',[_vm._v(\"所以luecne在返回结果中会把删除的文档踢出。\")]),_c('li',[_vm._v(\"ES会有后台线程根据luecne的合并规则定期进行segment mering合并操作，删除文档在合并segment的时候，才会被真正的删除。\")])]),_c('h1',[_vm._v(\"6、ES优化\")]),_c('h2',[_vm._v(\"6.1、批量提交\")]),_c('ul',[_c('li',[_vm._v(\"当有大量数据需要插入到ES中时，可以采用批量提交的方式查询。\")]),_c('li',[_vm._v(\"优化size大小，需要根据文档大小和服务器的性能来定。\")])]),_c('h2',[_vm._v(\"6.2、增加Refresh时间间隔\")]),_c('ul',[_c('li')])])])])}]\n\nexport { render, staticRenderFns }","import { render, staticRenderFns } from \"./Elasticsearch.md?vue&type=template&id=26776ec9&\"\nvar script = {}\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","module.exports = __webpack_public_path__ + \"img/1677134769658.06b5d9ef.jpg\";"],"sourceRoot":""}